!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(global,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=18)}([function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},,function(e,t){e.exports=require("path")},,function(e,t){e.exports=require("readline")},,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(1),a=n.n(i),c=n(3),u=n.n(c),f=n(4),l=n.n(f),s=n(2),p=n(8),d=n(6),h=function(e,t){return new Promise(function(n,r){var o=s.createReadStream(t),i=s.createWriteStream(e),a=function(){r()};o.on("error",a),i.on("error",a),o.on("close",function(){s.unlink(t,function(){n()})}),o.pipe(i)})};n.d(t,"default",function(){return m});var v={flags:"r",encoding:"utf8",fd:null,mode:438},m=function(){function e(t){u()(this,e),this.collections={},this.dataPath=t}return l()(e,[{key:"getOrCreateCollection",value:function(e){var t=this.collections[e];if(t)return t;var n={tempPath:d.resolve(this.dataPath,e+".tmp"),path:d.resolve(this.dataPath,e)};return this.collections[e]=n,s.existsSync(n.path)||s.writeFileSync(n.path,""),this.collections[e]}},{key:"dropCollection",value:function(){var e=a()(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.getOrCreateCollection(t),s.unlinkSync(n.path),delete this.collections[t];case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(e,t){var n=this;return new Promise(function(r,o){var i=n.getOrCreateCollection(e),a=s.createReadStream(i.path,v),c=p.createInterface(a),u=s.createWriteStream(i.tempPath,{encoding:"utf8"});c.on("line",function(e){var n=t(JSON.parse(e));u.write((n?JSON.stringify(n):e)+"\n")}),c.on("close",function(){u.end()}),u.on("close",function(){h(i.path,i.tempPath).then(function(){r()}).catch(function(e){o(e)})})})}},{key:"remove",value:function(e,t){var n=this;return new Promise(function(r,o){var i=n.getOrCreateCollection(e),a=s.createReadStream(i.path,v),c=p.createInterface(a),u=s.createWriteStream(i.tempPath,{encoding:"utf8"});c.on("line",function(e){t(JSON.parse(e))||u.write(e+"\n")}),c.on("close",function(){u.end()}),u.on("close",function(){h(i.path,i.tempPath).then(function(){r()}).catch(function(e){o(e)})})})}},{key:"append",value:function(e,t){var n=this;return new Promise(function(r,o){var i=n.getOrCreateCollection(e),a=s.createWriteStream(i.path,{flags:"a",encoding:"utf8"});a.on("finish",function(){r()}),a.on("error",function(e){o(e)}),a.on("open",function(){t.forEach(function(e){a.write(JSON.stringify(e)+"\n")}),a.end()})})}},{key:"read",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{raw:!1};return new Promise(function(o){var i=n.getOrCreateCollection(e),a=s.createReadStream(i.path,v),c=p.createInterface(a),u=!0;c.on("line",function(e){u&&((u=t(r.raw?e:JSON.parse(e)))||(c.close(),o()))}),c.on("close",function(){o()})})}}]),e}()}])});