!function(t,e){for(var r in e)t[r]=e[r]}(exports,function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=15)}([function(t,e){t.exports=require("@babel/runtime/regenerator")},function(t,e){t.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(t,e,r){"use strict";r.d(e,"a",function(){return u}),r.d(e,"b",function(){return o});var n=r(5),a=r.n(n);function u(t){var e=t;if(t&&"object"===a()(t))for(var r in e="[object Array]"===Object.prototype.toString.call(t)?[]:{},t)e[r]=u(t[r]);return e}function o(t){var e=(new Date).getTime();return"".concat(t).concat(e.toString(36)).concat(Math.random().toString(36))}},function(t,e){t.exports=require("@babel/runtime/helpers/classCallCheck")},function(t,e){t.exports=require("@babel/runtime/helpers/createClass")},function(t,e){t.exports=require("@babel/runtime/helpers/typeof")},function(t,e){t.exports=require("fs")},,,,,,function(t,e){t.exports=require("path")},,,function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return b});var n=r(5),a=r.n(n),u=r(0),o=r.n(u),i=r(1),c=r.n(i),s=r(3),f=r.n(s),p=r(4),l=r.n(p),h=r(6),v=r(12),d=r(2),b=function(){function t(e){f()(this,t),this.dataPath=e,this.collections={},h.existsSync(this.dataPath)||h.mkdirSync(this.dataPath),this.startJobLoop()}return l()(t,[{key:"getOrCreateCollection",value:function(){var t=c()(o.a.mark(function t(e){var r,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.collections[e]){t.next=6;break}return r=v.resolve(this.dataPath,e),n={path:r,isLocalLocking:!1,queue:[]},this.collections[e]=n,t.next=6,this.doJob(e,c()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:h.existsSync(n.path)||h.writeFileSync(n.path,"{}");case 1:case"end":return t.stop()}},t,this)})));case 6:return t.abrupt("return",this.collections[e]);case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"doJob",value:function(){var t=c()(o.a.mark(function t(e,r){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getOrCreateCollection(e);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,new Promise(function(t,e){n.queue.push(c()(o.a.mark(function a(){return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.t0=t,a.next=4,r(n);case 4:a.t1=a.sent,(0,a.t0)(a.t1),a.next=11;break;case 8:a.prev=8,a.t2=a.catch(0),e(a.t2);case 11:case"end":return a.stop()}},a,this,[[0,8]])})))});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()},{key:"getJson",value:function(){var t=c()(o.a.mark(function t(e){var r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getOrCreateCollection(e);case 2:return r=t.sent,t.next=5,this.doJob(e,c()(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=h.readFileSync(r.path,"utf8"),t.abrupt("return",JSON.parse(e));case 2:case"end":return t.stop()}},t,this)})));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"setItems",value:function(){var t=c()(o.a.mark(function t(e,r){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getOrCreateCollection(e);case 2:return n=t.sent,t.next=5,this.doJob(e,c()(o.a.mark(function t(){var e,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=h.readFileSync(n.path,"utf8"),a=JSON.parse(e),r.forEach(function(t){a[t._id]=t}),h.writeFileSync(n.path,JSON.stringify(a)),t.abrupt("return",r);case 5:case"end":return t.stop()}},t,this)})));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()},{key:"removeItems",value:function(){var t=c()(o.a.mark(function t(e,r){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getOrCreateCollection(e);case 2:return n=t.sent,t.next=5,this.doJob(e,c()(o.a.mark(function t(){var e,a,u;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=h.readFileSync(n.path,"utf8"),a=JSON.parse(e),u=[],r.forEach(function(t){var e=a[t];e&&u.push(Object(d.a)(e)),delete a[t]}),h.writeFileSync(n.path,JSON.stringify(a)),t.abrupt("return",u);case 6:case"end":return t.stop()}},t,this)})));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()},{key:"dropCollection",value:function(){var t=c()(o.a.mark(function t(e){var r=this;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.doJob(e,function(){var t=c()(o.a.mark(function t(n){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:h.unlinkSync(n.path),delete r.collections[e];case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"startJobLoop",value:function(){var t=this;setTimeout(function(){var e=function(e){var r=t.collections[e];if(!r||0===r.queue.length||r.isLocalLocking)return{v:void 0};r.isLocalLocking=!0,r.queue.shift()().then(function(){r.isLocalLocking=!1})};for(var r in t.collections){var n=e(r);if("object"===a()(n))return n.v}t.startJobLoop()},1)}}]),t}()}]));